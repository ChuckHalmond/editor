var e={d:(t,s)=>{for(var r in s)e.o(s,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:s[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)},t={};e.d(t,{HH:()=>_,Hw:()=>y,Ir:()=>O,KY:()=>H,TO:()=>k,bn:()=>A,t0:()=>V});var s,r,n,i,o,a,c,h,d,l,f,p,u,g,v,w,m,T,E,I=function(e,t,s,r,n){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!n)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?n.call(e,s):n?n.value=s:t.set(e,s),s},R=function(e,t,s,r){if("a"===s&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?r:"a"===s?r.call(e):r?r.value:t.get(e)};class M{constructor(e){this.target=e.target,this.changeType=e.changeType,this.propertyName=e.propertyName??null,this.oldValue=e.oldValue??void 0,this.newValue=e.newValue??void 0,this.removedIndex=e.removedIndex??0,this.removedItems=new P(e.removedItems??[]),this.insertedIndex=e.insertedIndex??0,this.insertedItems=new P(e.insertedItems??[]),this.sortedIndices=e.sortedIndices??[]}static get PROPERTY_CHANGE(){return 1}static get LIST_REMOVE(){return 2}static get LIST_INSERT(){return 3}static get LIST_SORT(){return 4}get PROPERTY_CHANGE(){return M.PROPERTY_CHANGE}get LIST_REMOVE(){return M.LIST_REMOVE}get LIST_INSERT(){return M.LIST_INSERT}get LIST_SORT(){return M.LIST_SORT}}var y=M;s=new WeakMap;var P=class{constructor(e){s.set(this,void 0),I(this,s,e.slice(),"f")}get length(){return R(this,s,"f").length}item(e){return R(this,s,"f")[e]??null}values(){return R(this,s,"f").values()}};class N{constructor(e){r.set(this,void 0),n.set(this,void 0),this.type=e,I(this,r,null,"f"),I(this,n,null,"f")}get currentTarget(){return R(this,r,"f")}get target(){return R(this,n,"f")}}r=new WeakMap,n=new WeakMap,N.ModelEventTargetAccessor=new class{setCurrentTarget(e,t){e instanceof N&&I(e,r,t,"f")}setTarget(e,t){e instanceof N&&I(e,n,t,"f")}};var S=N.ModelEventTargetAccessor;delete N.ModelEventTargetAccessor;var O=N;class b{constructor(){i.set(this,void 0),I(this,i,new Map,"f")}receiveEvent(e){const{type:t}=e,s=R(this,i,"f").get(t);S.setCurrentTarget(e,this),s&&s.forEach((t=>{t(e)}))}addEventListener(e,t){const s=R(this,i,"f").get(e);s?s.push(t):R(this,i,"f").set(e,[t])}removeEventListener(e,t){const s=R(this,i,"f").get(e);if(s){const r=s.findIndex((e=>e==t));r>-1&&s.splice(r,1),0==s.length&&R(this,i,"f").delete(e)}}dispatchEvent(e){S.setTarget(e,this),this.receiveEvent(e)}}i=new WeakMap;class L extends b{constructor(){super(),o.add(this),a.set(this,void 0),c.set(this,void 0),h.set(this,void 0),I(this,a,null,"f"),I(this,c,[],"f"),I(this,h,!1,"f")}get parentNode(){return R(this,a,"f")}setParent(e){if(null!==e){let t=e==this,{parentNode:s}=e;for(;!t&&null!==s;)({parentNode:s}=s),t=s==this;if(t)throw new TypeError("Failed to set parent on ModelNode: circular reference detected in the hierarchy.");I(this,a,e,"f")}else I(this,a,null,"f")}beginChanges(){I(this,h,!0,"f")}endChanges(){this.dispatchEvent(new O("modelchange")),R(this,c,"f").splice(0),I(this,h,!1,"f")}getRecords(){return R(this,c,"f").slice()}receiveEvent(e){super.receiveEvent(e);const{parentNode:t}=this;t&&t.receiveEvent(e)}}a=new WeakMap,c=new WeakMap,h=new WeakMap,o=new WeakSet,d=function(e,t,s){const r=R(this,c,"f"),n=new y({target:this,changeType:y.PROPERTY_CHANGE,propertyName:e,oldValue:t,newValue:s});r.push(n),R(this,h,"f")||(this.dispatchEvent(new O("modelchange")),r.splice(0))},l=function(e){R(this,c,"f").push(e),R(this,h,"f")||(this.dispatchEvent(new O("modelchange")),R(this,c,"f").splice(0))},L.ModelNodeRecordsAccessor=new class{triggerChange(e,t,s,r){e instanceof L&&R(e,o,"m",d).call(e,t,s,r)}handleRecord(e,t){e instanceof L&&R(e,o,"m",l).call(e,t)}};var x=L.ModelNodeRecordsAccessor;delete L.ModelNodeRecordsAccessor;var _=L;const k=function(){return(e,t)=>{const{constructor:s}=e,{prototype:r}=s;Object.defineProperty(r,t,{set:function(e){const s=C.getProperty(this,t);return C.setProperty(this,t,e),e!==s&&x.triggerChange(this,t,s,e),!0},get:function(){return C.getProperty(this,t)},enumerable:!0})}};class W extends L{constructor(){super(),f.set(this,void 0),I(this,f,new Map,"f")}}f=new WeakMap,W.ModelObjectPropertiesAccessor=new class{setProperty(e,t,s){e instanceof W&&R(e,f,"f").set(t,s)}getProperty(e,t){if(e instanceof W)return R(e,f,"f").get(t)}};var C=W.ModelObjectPropertiesAccessor;delete W.ModelObjectPropertiesAccessor;var A=W;p=new WeakMap;var V=class extends L{constructor(e){super(),p.set(this,void 0),I(this,p,e?.slice()??[],"f")}setParent(e){super.setParent(e),R(this,p,"f").forEach((t=>{t.setParent(e)}))}get length(){return R(this,p,"f").length}get(e){return R(this,p,"f")[e]??null}index(e){return R(this,p,"f").indexOf(e)}values(){return R(this,p,"f").values()}sort(e){const t=R(this,p,"f").map(((e,t)=>({item:e,index:t})));t.sort(((t,s)=>e(t.item,s.item))),I(this,p,t.map((e=>e.item)),"f");const s=new y({target:this,changeType:y.LIST_SORT,sortedIndices:t.map((e=>e.index))});x.handleRecord(this,s)}prepend(...e){const t=R(this,p,"f"),{parentNode:s}=this;s&&e.forEach((e=>{e.setParent(s)})),t.splice(0,0,...e);const r=new y({target:this,changeType:y.LIST_INSERT,insertedIndex:0,insertedItems:e});x.handleRecord(this,r)}append(...e){const t=R(this,p,"f"),{length:s}=t,{parentNode:r}=this;r&&e.forEach((e=>{e.setParent(r)})),t.push(...e);const n=new y({target:this,changeType:y.LIST_INSERT,insertedIndex:s,insertedItems:e});x.handleRecord(this,n)}insert(e,...t){const s=R(this,p,"f"),{length:r}=s;if(Math.abs(e)<=r){if(e>=0){const{parentNode:n}=this;t.forEach((e=>{e.setParent(n)})),e<r?s.splice(e,0,...t):s.push(...t)}else if(e<0){e=r-e;const{parentNode:n}=this;n&&t.forEach((e=>{e.setParent(n)})),s.splice(e,0,...t)}const n=new y({target:this,changeType:y.LIST_INSERT,insertedIndex:e,insertedItems:t.slice()});x.handleRecord(this,n)}}remove(e){const t=R(this,p,"f"),s=t.indexOf(e);if(s>-1){const e=t.splice(s,1)[0],{parentNode:r}=this;r&&e.setParent(null);const n=new y({target:this,changeType:y.LIST_REMOVE,removedIndex:s,removedItems:[e]});x.handleRecord(this,n)}}clear(){const e=R(this,p,"f"),{length:t}=e;if(t>0){const t=e.splice(0),{parentNode:s}=this;s&&t.forEach((e=>{e.setParent(null)}));const r=new y({target:this,changeType:y.LIST_REMOVE,removedIndex:0,removedItems:t});x.handleRecord(this,r)}}};g=new WeakMap,v=new WeakMap,w=new WeakMap,m=new WeakMap,u=new WeakSet,T=function(){const e=R(this,v,"f").splice(0);e.length>0&&R(this,g,"f").call(this,e)},E=function(e){if(!R(this,w,"f")){const{target:t,currentTarget:s}=e,r=R(this,m,"f").get(s);if(r){const{options:e}=r,{properties:n,propertiesFilter:i,childList:o,subtree:a}=e;a?n&&t instanceof _?(i?R(this,v,"f").push(...t.getRecords().filter((e=>{const{propertyName:t}=e;return i.includes(t)}))):R(this,v,"f").push(...t.getRecords()),R(this,u,"m",T).call(this)):o&&t instanceof V&&(R(this,v,"f").push(...t.getRecords()),R(this,u,"m",T).call(this)):t==s&&(n&&t instanceof _?(i?R(this,v,"f").push(...t.getRecords().filter((e=>{const{propertyName:t}=e;return i.includes(t)}))):R(this,v,"f").push(...t.getRecords()),R(this,u,"m",T).call(this)):o&&t instanceof V&&(R(this,v,"f").push(...t.getRecords()),R(this,u,"m",T).call(this)))}}};var H=class{constructor(e){u.add(this),g.set(this,void 0),v.set(this,void 0),w.set(this,void 0),m.set(this,void 0),I(this,g,e,"f"),I(this,v,[],"f"),I(this,w,!1,"f"),I(this,m,new WeakMap,"f")}observe(e,t){I(this,w,!1,"f");const s=R(this,m,"f");let r=s.get(e);if(r)s.set(e,r);else{const n=R(this,u,"m",E).bind(this);e.addEventListener("modelchange",n),r={listener:n,options:t},s.set(e,r)}}unobserve(e){let t=R(this,m,"f").get(e);if(t){const{listener:s}=t;e.removeEventListener("modelchange",s)}}disconnect(){R(this,v,"f").splice(0),I(this,w,!0,"f")}},j=t.KY,Y=t.Hw,G=t.Ir,F=t.t0,K=t.HH,q=t.bn,z=t.TO;export{j as ModelChangeObserver,Y as ModelChangeRecord,G as ModelEvent,F as ModelList,K as ModelNode,q as ModelObject,z as ModelProperty};
//# sourceMappingURL=Model.js.map